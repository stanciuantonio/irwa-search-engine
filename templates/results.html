{% extends "base.html" %}
{% block page_title %}Results{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Header Section -->
    <div class="results-header mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="results-title mb-2">Results for "{{ session['last_search_query'] }}"</h1>
                <div class="results-meta">
                    <span class="results-count">{{ found_counter }} items found</span>
                    <span class="results-divider">|</span>
                    <span class="results-algo">
                        <span class="algo-badge algo-{{ algorithm }}">{{ algorithm|upper }}</span>
                    </span>
                </div>
            </div>
            <div class="col-md-4 text-md-right mt-3 mt-md-0">
                <a href="/" class="btn btn-outline-dark">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" class="mr-1">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="M21 21l-4.35-4.35"></path>
                    </svg>
                    New Search
                </a>
            </div>
        </div>
    </div>

    <!-- RAG Recommendation -->
    {% if rag_response %}
    <div class="rag-section mb-5">
        <div class="rag-card">
            <div class="rag-header">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
                <span>AI Recommendation</span>
            </div>
            <div class="rag-content">{{ rag_response }}</div>
        </div>
    </div>
    {% endif %}

    <!-- Product Grid -->
    {% if found_counter > 0 %}
    <div class="row">
        {% for doc in results_list %}
        <div class="col-6 col-md-4 col-lg-3 mb-4">
            <div class="product-card">
                <a href="{{ doc.url }}&pos={{ loop.index }}" class="product-link">
                    <!-- Product Image -->
                    <div class="product-image-container">
                        {% if doc.images and doc.images|length > 0 %}
                            <img src="{{ doc.images[0] }}" class="product-image" alt="{{ doc.title }}" loading="lazy">
                        {% else %}
                            <div class="no-image">
                                <svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21 15 16 10 5 21"></polyline>
                                </svg>
                            </div>
                        {% endif %}

                        <!-- Stock Badge -->
                        {% if doc.out_of_stock %}
                        <span class="stock-badge out-of-stock">Out of Stock</span>
                        {% endif %}

                        <!-- Discount Badge -->
                        {% if doc.discount and doc.discount > 0 %}
                        <span class="discount-tag">-{{ doc.discount|int }}%</span>
                        {% endif %}
                    </div>

                    <!-- Product Info -->
                    <div class="product-info">
                        <!-- Brand -->
                        {% if doc.brand %}
                        <div class="product-brand">{{ doc.brand }}</div>
                        {% endif %}

                        <!-- Title -->
                        <h3 class="product-title">{{ doc.title }}</h3>

                        <!-- Rating -->
                        {% if doc.average_rating %}
                        <div class="product-rating">
                            <span class="rating-star">&#9733;</span>
                            <span class="rating-value">{{ doc.average_rating }}</span>
                        </div>
                        {% endif %}

                        <!-- Price -->
                        <div class="product-price-row">
                            {% if doc.selling_price %}
                            <span class="product-price">${{ "%.2f"|format(doc.selling_price) }}</span>
                            {% endif %}
                            {% if doc.actual_price and doc.actual_price != doc.selling_price %}
                            <span class="product-original-price">${{ "%.2f"|format(doc.actual_price) }}</span>
                            {% endif %}
                        </div>

                        <!-- Ranking Score (subtle) -->
                        {% if doc.ranking_score %}
                        <div class="ranking-info">
                            <span class="ranking-position">#{{ doc.ranking_position }}</span>
                            <span class="ranking-score">Score: {{ doc.ranking_score }}</span>
                        </div>
                        {% endif %}
                    </div>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- No Results -->
    <div class="no-results">
        <svg width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="M21 21l-4.35-4.35"></path>
            <path d="M8 8l6 6M14 8l-6 6"></path>
        </svg>
        <h3>No Results Found</h3>
        <p>We couldn't find any products matching your search. Try different keywords or check your spelling.</p>
        <a href="/" class="btn btn-dark mt-3">Try Another Search</a>
    </div>
    {% endif %}

</div>

<style>
/* Results Header */
.results-header {
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #e9ecef;
}

.results-title {
    font-size: 1.5rem;
    font-weight: 700;
}

.results-meta {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.9rem;
    color: #6c757d;
}

.results-divider {
    color: #dee2e6;
}

.algo-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.algo-badge.algo-tfidf { background: #e8f5e9; color: #2e7d32; }
.algo-badge.algo-bm25 { background: #e3f2fd; color: #1565c0; }
.algo-badge.algo-custom { background: #fff3e0; color: #ef6c00; }
.algo-badge.algo-word2vec { background: #f3e5f5; color: #7b1fa2; }

/* RAG Section */
.rag-section {
    margin-top: 1.5rem;
}

.rag-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 16px;
    overflow: hidden;
}

.rag-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 1rem 1.5rem;
    background: rgba(0,0,0,0.03);
    font-weight: 700;
    font-size: 0.9rem;
}

.rag-content {
    padding: 1.5rem;
    white-space: pre-line;
    line-height: 1.7;
    font-size: 0.95rem;
}

/* Product Card */
.product-card {
    height: 100%;
    transition: transform 0.2s ease;
}

.product-card:hover {
    transform: translateY(-4px);
}

.product-link {
    display: block;
    text-decoration: none;
    color: inherit;
}

.product-image-container {
    position: relative;
    background-color: #f5f5f5;
    border-radius: 12px;
    overflow: hidden;
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

.product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-card:hover .product-image {
    transform: scale(1.05);
}

.no-image {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    color: #adb5bd;
}

.stock-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
}

.stock-badge.out-of-stock {
    background: #dc3545;
    color: white;
}

.discount-tag {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #000;
    color: #fff;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
}

/* Product Info */
.product-info {
    padding: 1rem 0.5rem;
}

.product-brand {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #6c757d;
    margin-bottom: 4px;
}

.product-title {
    font-size: 0.9rem;
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: 8px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    color: #000;
}

.product-rating {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-bottom: 8px;
}

.rating-star {
    color: #ffc107;
    font-size: 0.9rem;
}

.rating-value {
    font-size: 0.8rem;
    font-weight: 600;
    color: #333;
}

.product-price-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.product-price {
    font-size: 1.1rem;
    font-weight: 700;
    color: #000;
}

.product-original-price {
    font-size: 0.85rem;
    color: #adb5bd;
    text-decoration: line-through;
}

.ranking-info {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
    font-size: 0.65rem;
    color: #adb5bd;
}

.ranking-position {
    background: #f5f5f5;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: 600;
}

.ranking-score {
    font-family: monospace;
}

/* No Results */
.no-results {
    text-align: center;
    padding: 4rem 2rem;
}

.no-results svg {
    color: #adb5bd;
    margin-bottom: 1.5rem;
}

.no-results h3 {
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.no-results p {
    color: #6c757d;
    max-width: 400px;
    margin: 0 auto;
}

/* Responsive */
@media (max-width: 576px) {
    .results-title {
        font-size: 1.25rem;
    }

    .product-title {
        font-size: 0.8rem;
    }

    .product-price {
        font-size: 1rem;
    }
}
</style>
{% endblock %}
